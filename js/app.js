var app=angular.module("ellis",[]);app.controller("AppController",["$scope","$http",function(a,b){b.get("./data/ellis.json").success(function(b){a.ellis_evictions=b,console.log("data=%o",b),a.showGraph("month","petitions")}),a.classForTypeButton=function(b){return[a.type==b?"active":"","btn","btn-small"]},a.showGraph=function(b,c){a.coalesce=b,a.type=c;var d=700,e=300,f=20,g=40;if(a.isSetUp)var h=d3.select("#graph svg");else{graph_container=d3.select("#graph"),graph_container.html("");var h=graph_container.append("svg:svg").attr("width",d).attr("height",e+100);h.append("g").attr("class","bars"),a.isSetUp=!0}var i=[];angular.forEach(a.ellis_evictions,function(a,b){angular.forEach(a,function(a,c){var d=new Date(parseInt(b),parseInt(c));i.push({date:d,units:a[1],petitions:a[0]})})});var j=d3.time.scale().domain([i[0].date,i[i.length-1].date]).rangeRound([0,d-2*g]),k=d3.scale.linear().domain([0,d3.max(i,function(a){return a[c]})]).range([e-2*f,f]),l=d3.svg.axis().scale(j).orient("bottom").ticks(d3.time.year,1).tickFormat(d3.time.format("%Y")).tickSize(0).tickPadding(8),m=d3.svg.axis().scale(k).orient("left"),n=d3.selectAll("g.bars");n.selectAll("rect").remove(),n.selectAll("rect").data(i).enter().append("rect").attr("width",1).transition().attr("y",function(a){return e-f-(e-2*f-k(a[c]))}).attr("height",function(a){return e-2*f-k(a[c])}).attr("x",function(a){return g+j(a.date)}),h.selectAll("g.x-axis").remove(),h.selectAll("g.y-axis").remove(),h.append("g").attr("class","x-axis").attr("transform","translate("+g+", "+(e-f)+")").call(l).selectAll("text").style("text-anchor","end").attr("dy","-.5em").attr("dx","-1em").attr("transform","rotate(-80)").call(l),h.append("g").attr("class","y-axis").attr("transform","translate("+g+","+f+")").call(m)}}]);